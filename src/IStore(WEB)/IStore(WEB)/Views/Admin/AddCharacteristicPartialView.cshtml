@model Domain.EF_Models.GroupCharacteristic

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>

    $(function () {

        $(".prodid").attr("readonly", true);
        $(".idchar").attr("readonly", true);

        $('html').on('click', '.addBtn', function () {

            $(this).parent().find(".cont").append($(".innerBox").last().clone());
            $(this).parent().find(".cont").find(".innerBox").last().children().eq(4).val("");
            $(this).parent().find(".cont").find(".innerBox").last().children().eq(7).val("");
            $(this).parent().find(".cont").find(".innerBox").last().find(".idchar").val("0");
            $(".idchar").attr("readonly", true);
        });

         $('html').on('click', '.addGroup',function () {

             $("tbody").append($(".tableBox").last().clone());
             $(".tableBox").last().find("td").find(".innerBox:not(:first)").remove();
             $(".tableBox").last().find("td").find("input").val(" ");
             $(".tableBox").last().find('td').find(".idgroup").text("0");
             $(".tableBox").last().find('td').find(".prodid").val($(".tableBox").first().find('td').find(".prodid").val()).attr("readonly", true);
             $(".tableBox").last().find('td').find(".idchar").val("0").attr("readonly", true);
         });

        $('.saveBtn').on('click', function () {

            var groups = [];

            var groupsElements = $(".tableBox");

            $(groupsElements).each(function (){
                var characteristics = [];

                var idgroup = $(this).find('td').find(".idgroup").text().replace(/\n/ig, '').trim();

                $(this).find(".innerBox").each(function () {

                    var charact = new Object();
                    charact.Id = $(this).find(".idchar").val();
                    charact.Title = $(this).find(".titleChar").val();
                    charact.Value = $(this).find(".value").val();
                    charact.GroupCharacteristicId = idgroup;

                    characteristics.push(charact);
                });

                var group = new Object();
                group.Title = $(this).find('td').find(".titleGroup").val();
                group.ProductId = $(this).find('td').find(".prodid").val();
                group.Characteristics = characteristics;
                group.Id = idgroup;

                groups.push(group);

            });

            $.ajax({
                type: "POST",
                url: "/admin/GetCharacteristic",
                data: {parameters : JSON.stringify(groups)},
                dataType: "JSON"
          });
        });
    });

</script>


<div>
    <table class="table table-striped">
        <thead>
            <tr>

                <th>
                    @Html.LabelForModel("Group title")
                </th>

                <th>
                    @Html.LabelForModel("Characteristics")
                </th>

                <th></th>
            </tr>
        </thead>
        <tbody>



            <tr class="tableBox">


                <td>
                    @Html.Editor("editor", new { htmlAttributes = new { @class = "titleGroup" } })
                </td>

                <td>
                    <div class="cld">
                        <div class="cont">

                            <div class="innerBox">
                                @Html.Label("Title")
                                @Html.Editor("editor", new { htmlAttributes = new { @class = "titleChar" } })
                                <label> </label>
                                @Html.Label("Value")
                                @Html.Editor("editor", new { htmlAttributes = new { @class = "value" } })
                                <br>
                            </div>

                        </div>

                        <button class="addBtn">Add сharacteristic</button>
                    </div>
                </td>
            </tr>



        </tbody>

    </table>
    <br />
    <button class="addGroup">Add group</button>
</div>